<template>
  <VButton
    v-bind="$attrs"
    :aria-label="$t('search.search')"
    size="disabled"
    class="inline-block rounded-s-none border-b border-b-pink font-semibold text-2xl"
    :class="[
      isIcon ? 'search-button p-[0.5px] ps-[1.5px]' : 'py-6 px-10 h-full',
      sizeClasses,
      isIcon && isHomeRoute
        ? 'bg-pink text-white border-tx'
        : 'border-dark-charcoal-20',
    ]"
    v-on="$listeners"
  >
    <template v-if="isIcon">
      <VIcon :icon-path="searchIcon" />
    </template>
    <template v-else>
      <span>{{ $t('search.search') }}</span>
    </template>
  </VButton>
</template>

<script>
import { computed } from '@nuxtjs/composition-api'
import { isMinScreen } from '~/composables/use-media-query'
import { useBrowserIsMobile } from '~/composables/use-browser-detection'

import VButton from '~/components/VButton.vue'
import VIcon from '~/components/VIcon/VIcon.vue'

import searchIcon from '~/assets/icons/search.svg'

export default {
  name: 'VSearchButton',
  components: { VIcon, VButton },
  inheritAttrs: false,
  props: {
    size: {
      type: String,
      required: true,
      validator: (v) => ['small', 'medium', 'large', 'standalone'].includes(v),
    },
    isHomeRoute: {
      type: Boolean,
      default: false,
    },
  },
  setup(props) {
    const isMobile = useBrowserIsMobile()
    const isMinScreenMd = isMinScreen('md', { shouldPassInSSR: !isMobile })
    const isIcon = computed(() => {
      // split the evaluation of the isMinScreenMd ref
      // out to prevent short-circuiting from creating
      // problems with `computed`'s dependency detection
      const currentIsMinScreenMd = isMinScreenMd.value

      return props.size === 'standalone' && !currentIsMinScreenMd
    })

    const sizeClasses = computed(() => {
      return isIcon
        ? {
            small: ['w-10', 'md:w-12', 'h-10', 'md:h-12'],
            medium: ['w-12', 'h-12'],
            large: ['w-14', 'h-14'],
            standalone: ['w-14', 'md:w-[69px]', 'h-14', 'md:h-[69px]'],
          }[props.size]
        : undefined
    })

    return { isMinScreenMd, searchIcon, sizeClasses, isIcon }
  },
}
</script>

<style scoped>
.search-button {
  /* Negative margin removes a tiny gap between the button and the input borders */
  margin-inline-start: -1px;
  border-inline-start-color: transparent;
  border-width: 1px;
}
.search-button.search-button:not(:hover):not(:focus):not(:focus-within) {
  border-inline-start-color: transparent;
  border-width: 1px;
}
.search-button.search-button:hover {
  border-inline-start-color: rgba(214, 212, 213, 1);
  border-width: 1px;
}
</style>
